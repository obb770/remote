<!DOCTYPE html>
<html>
 <head>
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style"
    content="black-translucent" />
  <link rel="apple-touch-icon-precomposed" href="touch-icon.png" />
  <link rel="shortcut icon" href="touch-icon.png" />
  <style type="text/css">
body {
    font-size: 166%;
    font-family: sans-serif;
}
#startup {
    margin-top: 80px auto;
    color: rgba(128, 128, 128, 0.5);
}
#ui {
    margin-top: 40px;
}
#list {
    width: 100%;
    -webkit-appearance: none;
    font-size: inherit;
}
table {
    width: 100%;
}
#selected {
    text-align: center;
    margin-top: 1em;
    font-size: 80%;
}
#video {
    text-align: center;
}
.button {
    width: 100%;
    padding: 1em 0;
    -webkit-appearance: none;
    -webkit-border-radius: 10px;
    background-color: green;
}
#log {
    font-family: monospace;
    font-size: .5em;
}
  </style>
  <title>OMXRemote</title>
 </head>
 <body>
  <div id="startup">
  <h1>Loading...</h1>
  </div>
  <div id="ui">
   <table>
    <tr>
     <td>
      <button id="seekminus30" class="button">
       <img width="64px" src="media-seek-backward.svg">
      </button>
     </td>
     <td>
      <button id="pauseorresume" class="button">
       <img width="64px" src="media-playback-pause.svg">
      </button>
     </td>
     <td>
      <button id="seekplus30" class="button">
       <img width="64px" src="media-seek-forward.svg">
      </button>
     </td>
    </tr>
    <tr>
     <td>
      <button id="play" class="button">
       <img width="64px" src="media-playback-start.svg">
      </button>
     </td>
     <td>
      <button id="reload" class="button">
       <img width="64px" src="view-refresh.svg">
      </button>
     </td>
     <td>
      <button id="stop" class="button">
       <img width="64px" src="media-playback-stop.svg">
      </button>
     </td>
    </tr>
   </table>
   <div>
    <select id="list">
    </select>
   </div>
   <div id="selected">
   </div>
   <div id="video">
   </div>
   <div id="log">
   </div>
  </div>
  <script type="text/javascript">
(function () {
/*jshint browser:true */
'use strict';
var qs = function (q) {return document.querySelector(q);},
    log,
    request,
    populateList,
    file = null,
    buttons,
    lastDown,
    timeDown;

log = function (m) {
    qs('#log').innerHTML = '<hr>' + m + qs('#log').innerHTML;
    document.body.scrollTop = document.documentElement.scrollTop = 0;
};

request = function (op, args) {
    var xhr = new XMLHttpRequest(),
        url = op,
        key,
        params = [];
    for (key in args) {
        if (args.hasOwnProperty(key)) {
            params.push(key + '=' + encodeURIComponent(args[key]));
        }
    }
    url = url + '?' + params.join('&');
    xhr.open('GET', url, false);
    xhr.send();
    if (xhr.status != 200) {
        log(xhr.responseText);
        return null;
    }
    return JSON.parse(xhr.responseText);
};

populateList = function (listElement) {
    var list = request('list', {});
    listElement.innerHTML =
        '<option>' + 'Click to select media...' + '</option>' + 
        '<option>' + list.join('</option><option>') + '</option>';
};

populateList(qs('#list'));

qs('#list').addEventListener('change', function () {
    var list = qs('#list');
    file = list.options[list.selectedIndex].textContent;
    qs('#selected').innerHTML = file.replace(/^.*\//, ' ').replace(/\./g, ' ');
    qs('#video').innerHTML = '';
    if (/\.(mp4|m4v)$/.test(file)) {
        qs('#video').innerHTML = '<video width="160" height="120" ' +
            'src="' + file + '" controls></video>';
    }
    setTimeout(function () {
        qs('#list').selectedIndex = 0;
        qs('#list').value = list.options[list.selectedIndex].textContent;
        document.body.scrollTop = document.documentElement.scrollTop = 0;
    }, 0);
});

buttons = {
    '#seekminus30': function () {
        request('control', {'command': 'seekMinus30'});
    },
    '#pauseorresume': function () {
        request('control', {'command': 'pauseOrResume'});
    },
    '#seekplus30': function () {
        request('control', {'command': 'seekPlus30'});
    },
    '#play': function () {
        request('play', {'file': file});
    },
    '#reload': function () {
        qs('#log').innerHTML = '';
        populateList(qs('#list'));
        qs('#selected').innerHTML = '';
        qs('#video').innerHTML = '';
    },
    '#stop': function () {
        request('control', {'command': 'exitOMXPlayer'});
    },
    '#selected': function () {
        request('archive', {'file': file});
        qs('#selected').innerHTML = '';
        qs('#video').innerHTML = '';
        file = null;
    }
};

Object.keys(buttons).forEach(function (id) {
    var down,
        up,
        listen;
    down = function () {
        lastDown = id;
        timeDown = new Date();
        if (id !== '#selected') {
            qs(id).style['background-color'] = 'darkgreen';
        }
    };
    up = function () {
        var same = lastDown === id,
            duration = new Date() - timeDown,
            act = duration < 1000;
        if (same) {
            if (id === '#selected') {
                act = !act;
            }
            if (act) {
                buttons[id]();
            }
        }
        if (lastDown !== '#selected') {
            qs(lastDown).style['background-color'] = 'green';
        }
    };
    listen = function (ev, cb) {
        qs(id).addEventListener(ev, function (e) {
            e.preventDefault();
            if (cb) {
                cb();
            }
        });
    };
    listen('mousedown', down);
    listen('mousemove');
    listen('mouseup', up);
    listen('touchstart', down);
    listen('touchmove');
    listen('touchend', up);
});

qs('#ui').style.visibility = 'hidden';
window.addEventListener('load', function() {
    qs('#startup').style.display = 'none';
    qs('#ui').style.visibility = 'visible';
});

}());
  </script>
 </body>
</html>
